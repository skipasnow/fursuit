<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kemono Fursuit Makers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator_midnight.min.css" rel="stylesheet">
<style>
    body {
        background: #2e2e2e;
        color: #fff;
        font-family: sans-serif;
        padding: 20px;
    }

    #creator-table {
        margin: auto;
        width: 85%;
    }

    .logo-icon {
        width: 48px;
        height: 48px;
        object-fit: contain;
        border-radius: 8px;
        cursor: pointer;
    }

    .logo-hover-preview {
        position: relative;
        display: inline-block;
    }

    .logo-hover-preview:hover::after {
        content: '';
        position: absolute;
        top: 0;
        left: 100%;
        width: 200px;
        height: 200px;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        border: 2px solid #fff;
        z-index: 100;
    }

    .tabulator-cell a {
        color: darkorange;
    }

    .tabulator-cell a:visited {
        color: darkorange;
    }

    .tabulator-cell a:hover {
        color: orangered;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>
</head>
<body>

<h1>Kemono Fursuit Makers</h1>
<div id="creator-table"></div>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQesC2Kuwk-4S3ID4cCsCvOGM4U0DstvIoewGKQn4pZII8mkoa6fxcN18ozOO3_EkISGIkZNVngLYdN/pub?gid=131139777&single=true&output=csv";

// Custom formatter for Logo column to parse =IMAGE("URL") and add hover
function logoFormatter(cell){
    const val = cell.getValue();
    let imageUrl = val;
    const match = val.match(/^=IMAGE\("([^"]+)"\)/i);
    if(match) imageUrl = match[1];
    return `<span class="logo-hover-preview" style="background-image:url('${imageUrl}');">
                <img src="${imageUrl}" class="logo-icon">
            </span>`;
}

// Custom formatter for Preview column hover
function previewFormatter(cell){
    const url = cell.getValue();
    if(!url) return "";
    return `<span class="logo-hover-preview" style="background-image:url('${url}');">
                <img src="${url}" class="logo-icon">
            </span>`;
}

// Generic gradient formatter
function gradientFormatter(cell, minVal, maxVal, invert=false){
    const val = parseFloat(cell.getValue());
    if(isNaN(val)) return cell.getValue();
    let percent = (val - minVal)/(maxVal - minVal);
    if(invert) percent = 1 - percent;
    const r = Math.round(255 * percent);
    const g = Math.round(255 * (1 - percent));
    return `<div style="background-color: rgb(${r},${g},0); color: #fff; text-align:center;">${val}</div>`;
}

Papa.parse(csvUrl, {
    download: true,
    header: true,
    complete: function(results) {
        const data = results.data.map(row => {
            ["Price", "Partials", "Fursuits", "Portfolio Size", "Followers", "Acct Age"].forEach(f => {
                if(row[f]) row[f] = parseFloat(row[f].replace(/,/g,''));
            });
            return row;
        });

        // Compute min/max for each numeric column
        const columnsToGradient = ["Price", "Partials", "Fursuits", "Portfolio Size", "Followers", "Acct Age"];
        const minMax = {};
        columnsToGradient.forEach(col=>{
            const vals = data.map(d=>parseFloat(d[col])).filter(v=>!isNaN(v));
            minMax[col] = {min: Math.min(...vals), max: Math.max(...vals)};
        });

        const columns = [
            {title:"Rank", field:"Rank", width:70, sorter:"number"},
            {title:"Logo", field:"Logo", formatter:logoFormatter, hozAlign:"center", width:80, headerSort:false},
            {title:"Maker", field:"Maker", sorter:"string"},
            {title:"Maker Type", field:"Maker Type", sorter:"string"},
            {title:"Link", field:"Link", sorter:"string", formatter:"link"},
            {title:"Preview", field:"Preview", formatter:previewFormatter, hozAlign:"center", width:80},
            {title:"$ Price", field:"Price", sorter:"number", formatter:function(cell){
                return gradientFormatter(cell, minMax.Price.min, minMax.Price.max);
            }},
            {title:"Partials", field:"Partials", sorter:"number", formatter:function(cell){
                return gradientFormatter(cell, minMax.Partials.min, minMax.Partials.max, true);
            }},
            {title:"Fursuits", field:"Fursuits", sorter:"number", formatter:function(cell){
                return gradientFormatter(cell, minMax.Fursuits.min, minMax.Fursuits.max, true);
            }},
            {title:"Portfolio Size", field:"Portfolio Size", sorter:"number", formatter:function(cell){
                return gradientFormatter(cell, minMax["Portfolio Size"].min, minMax["Portfolio Size"].max, true);
            }},
            {title:"Country", field:"Country"},
            {title:"Followers", field:"Followers", sorter:"number", formatter:function(cell){
                return gradientFormatter(cell, minMax.Followers.min, minMax.Followers.max, true);
            }},
            {title:"Acct Age", field:"Acct Age", sorter:"number", formatter:function(cell){
                return gradientFormatter(cell, minMax["Acct Age"].min, minMax["Acct Age"].max, true);
            }},
            {title:"Specialty", field:"Specialty", headerFilter:"input"},
        ];

        const table = new Tabulator("#creator-table", {
            data: data,
            layout:"fitDataStretch",
            columns: columns,
            movableColumns:true,
            resizableColumns:true,
            height:"85vh",
            rowFormatter:function(row){
                if(row.getPosition() % 2){
                    row.getElement().style.backgroundColor = "#333";
                }else{
                    row.getElement().style.backgroundColor = "#2e2e2e";
                }
            },
            initialSort:[{column:"Rank", dir:"asc"}]
        });
    }
});
</script>

</body>
</html>

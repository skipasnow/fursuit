<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kemono Fursuit Makers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Tabulator CSS -->
<link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet">

<style>
  body {
    background: #2e2e2e;
    color: #fff;
    font-family: sans-serif;
    padding: 20px;
    margin: 0;
  }

  h1 {
    color: #fff;
  }

  #creator-table {
    margin-top: 20px;
  }

  /* Dark theme for Tabulator */
  .tabulator {
    background: #2e2e2e !important;
    color: #fff !important;
    border: 1px solid #555 !important;
  }

  .tabulator .tabulator-header {
    background-color: #1f1f1f !important;
    color: #fff !important;
    border-bottom: 2px solid #555 !important;
  }

  .tabulator .tabulator-header .tabulator-col {
    border-right: 1px solid #555 !important;
  }

  .tabulator .tabulator-row {
    border-bottom: 1px solid #444 !important;
    color: #fff !important;
  }

  /* Alternating row colors */
  .tabulator .tabulator-row.tabulator-row-even {
    background-color: #2a2a2a !important;
  }

  .tabulator .tabulator-row.tabulator-row-odd {
    background-color: #3a3a3a !important;
  }

  .tabulator .tabulator-cell {
    color: #fff !important;
    background-color: inherit !important;
  }

  /* Link color overrides */
  .tabulator .tabulator-cell a {
    color: #FF8C00 !important; /* dark orange */
    text-decoration: underline;
  }
  .tabulator .tabulator-cell a:visited {
    color: #FF8C00 !important;
  }
  .tabulator .tabulator-cell a:hover {
    color: #FFA500 !important; /* slightly lighter on hover */
  }

  /* Hover image tooltip */
  #hover-image {
    position: absolute;
    display: none;
    width: 250px;
    height: 250px;
    border: 2px solid #fff;
    z-index: 1000;
    pointer-events: none;
    background-color: #2e2e2e;
    transition: opacity 0.2s ease-in-out; /* smooth fade */
  }

  /* Loader message */
  #loader {
    color: #fff;
    font-size: 18px;
    text-align: center;
    margin-top: 50px;
  }
</style>
</head>
<body>

<h1>Kemono Fursuit Makers</h1>
<div id="loader">Loading data...</div>
<div id="creator-table"></div>
<img id="hover-image" src="" alt="Preview">

<!-- Dependencies -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQesC2Kuwk-4S3ID4cCsCvOGM4U0DstvIoewGKQn4pZII8mkoa6fxcN18ozOO3_EkISGIkKNVngLYdN/pub?gid=131139777&single=true&output=csv";

Papa.parse(csvUrl, {
  download: true,
  header: true,
  complete: function(results) {
    const data = results.data.filter(row => row.Maker); // remove empty rows

    if(!data.length) {
      document.getElementById("loader").textContent = "No data found.";
      return;
    }

    document.getElementById("loader").style.display = "none"; // hide loader

    const columns = Object.keys(data[0]).map(colName => {
      if(colName === "Rank"){
        return {
          title: colName,
          field: colName,
          resizable: true,
          headerFilter:false,
          sorter:"number",
        };
      } else if(colName === "Specialty"){
        return {
          title: colName,
          field: colName,
          resizable: true,
          headerFilter:"input",
          sorter:"string"
        };
      } else if(colName === "Preview"){
        return {
          title: colName,
          field: colName,
          resizable:true,
          sorter:false,
          formatter:function(cell){
            const value = cell.getValue();
            if(!value) return "";
            return `<span class="preview-hover" data-src="${value}">Hover</span>`;
          }
        };
      } else if(colName === "Link"){
        return {
          title: colName,
          field: colName,
          resizable:true,
          sorter:"string",
          formatter:"link",
          formatterParams:{labelField:colName, urlField:colName, target:"_blank"}
        };
      } else {
        return {
          title: colName,
          field: colName,
          resizable:true,
          sorter:"string"
        };
      }
    });

    const table = new Tabulator("#creator-table", {
      data: data,
      layout:"fitDataTable",
      columns: columns,
      movableColumns: true,
      height: "85vh",       // freezes header while scrolling
      reactiveData: true,
      initialSort:[{column:"Rank", dir:"asc"}],
    });

    // Hover image tooltip with edge detection
    const hoverImg = document.getElementById("hover-image");
    const container = document.querySelector("#creator-table");

    container.addEventListener("mousemove", function(e){
      const target = e.target.closest(".preview-hover");
      if(target){
        hoverImg.src = target.dataset.src;
        hoverImg.style.display = "block";
        hoverImg.style.opacity = 1;

        const vw = window.innerWidth;
        const vh = window.innerHeight;
        let left = e.pageX + 10;
        let top = e.pageY + 10;

        if(left + hoverImg.width > window.scrollX + vw){
          left = e.pageX - hoverImg.width - 10;
        }
        if(top + hoverImg.height > window.scrollY + vh){
          top = e.pageY - hoverImg.height - 10;
        }

        hoverImg.style.left = left + "px";
        hoverImg.style.top = top + "px";
      } else {
        hoverImg.style.opacity = 0;
        hoverImg.style.display = "none";
      }
    });
  }
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kemono Fursuit Makers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Tabulator CSS -->
<link href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator_midnight.min.css" rel="stylesheet">

<style>
  body {
    background: #2e2e2e;
    color: #fff;
    font-family: sans-serif;
    padding: 20px;
  }

  #creator-table {
    width: 95%;
    margin: auto;
  }

  .hover-preview {
    position: relative;
    display: inline-block;
  }

  .hover-preview::after {
    content: '';
    position: absolute;
    top: 0;
    left: 100%;
    width: 200px;
    height: 200px;
    background-size: cover;
    border: 2px solid #fff;
    z-index: 100;
    display: none;
  }

  .hover-preview:hover::after {
    display: block;
  }

  /* URL styling */
  a {
    color: darkorange;
    text-decoration: none;
  }
  a:hover {
    color: orangered;
  }

  /* Tabulator header dark */
  .tabulator .tabulator-header {
    background-color: #1f1f1f !important;
    color: #fff !important;
  }

  /* Complete cell borders */
  .tabulator .tabulator-cell,
  .tabulator .tabulator-row .tabulator-cell,
  .tabulator .tabulator-header .tabulator-col {
    border: 1px solid #fff !important;
  }
</style>
</head>
<body>

<h1>Kemono Fursuit Makers</h1>
<div id="creator-table"></div>

<!-- Tabulator JS -->
<script src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQesC2Kuwk-4S3ID4cCsCvOGM4U0DstvIoewGKQn4pZII8mkoa6fxcN18ozOO3_EkISGIkKNVngLYdN/pub?gid=131139777&single=true&output=csv";

// Gradient helper: green (#2E6F40) → dark midpoint → red (#B31B1B)
function getGradientColor(value, min, max, reverse=false){
    if(value==null||isNaN(value)) return "";
    const ratio = (value - min)/(max-min);
    const darkRow = [46,46,46]; // dark row RGB
    const green = [46,111,64];
    const red = [179,27,27];
    let r,g,b;

    if(reverse){
        if(ratio<0.5){
            r = Math.round(red[0]+(darkRow[0]-red[0])*(ratio*2));
            g = Math.round(red[1]+(darkRow[1]-red[1])*(ratio*2));
            b = Math.round(red[2]+(darkRow[2]-red[2])*(ratio*2));
        }else{
            r = Math.round(darkRow[0]+(green[0]-darkRow[0])*((ratio-0.5)*2));
            g = Math.round(darkRow[1]+(green[1]-darkRow[1])*((ratio-0.5)*2));
            b = Math.round(darkRow[2]+(green[2]-darkRow[2])*((ratio-0.5)*2));
        }
    } else {
        if(ratio<0.5){
            r = Math.round(green[0]+(darkRow[0]-green[0])*(ratio*2));
            g = Math.round(green[1]+(darkRow[1]-green[1])*(ratio*2));
            b = Math.round(green[2]+(darkRow[2]-green[2])*(ratio*2));
        }else{
            r = Math.round(darkRow[0]+(red[0]-darkRow[0])*((ratio-0.5)*2));
            g = Math.round(darkRow[1]+(red[1]-darkRow[1])*((ratio-0.5)*2));
            b = Math.round(darkRow[2]+(red[2]-darkRow[2])*((ratio-0.5)*2));
        }
    }
    return `rgb(${r},${g},${b})`;
}

// Dynamic text color
function getTextColor(value,min,max){
    if(value==null||isNaN(value)) return "#fff";
    const ratio = (value-min)/(max-min);
    return (ratio>0.45 && ratio<0.55) ? "#2e2e2e" : "#000";
}

Papa.parse(csvUrl,{
    download:true,
    header:true,
    dynamicTyping:true,
    complete:function(results){
        const data = results.data.map(row=>({
            rank: row['Rank'],
            maker: row['Maker'],
            logo: row['Logo'],
            makerType: row['Maker Type'],
            link: row['Link'],
            preview: row['Preview'],
            price: row['$ Price'],
            shipOrFly: row['$ Ship or Fly'],
            tariff: row['$ Tariff (2025)'],
            ship: row['$ Ship'],
            airTravel: row['$ Air Travel'],
            travelSurplus: row['$ Travel Surplus'],
            aesthetic: row['Aesthetic'],
            status: row['Status'],
            specialty: row['Specialty'],
            partials: row['Partials'],
            fursuits: row['Fursuits'],
            portfolio: row['Portfolio Size'],
            country: row['Country'],
            followers: row['Followers'],
            acctAge: row['Acct Age'],
            rep: row['Rep'],
            timeline: row['Timeline'],
            acctDate: row['Acct Date'],
            rankScore: row['Rank Score'],
            imperfections: row['Imperfections'],
            worksPerYear: row['Works Per Year'],
            worksRank: row['Works Rank'],
            followersRank: row['Followers Rank'],
            acctDateRank: row['Acct Date Rank'],
            partialsRank: row['Partials Rank'],
            fursuitsRank: row['Fursuits Rank'],
            priceRank: row['Price Rank']
        }));

        const numericCols = ['price','partials','fursuits','portfolio','followers','acctAge'];
        const colMinMax = {};
        numericCols.forEach(col=>{
            const vals = data.map(d=>d[col]).filter(v=>v!=null && !isNaN(v));
            colMinMax[col] = {min:Math.min(...vals), max:Math.max(...vals)};
        });

        new Tabulator("#creator-table",{
            data:data,
            height:"85vh",
            layout:"fitDataTable",
            movableColumns:true,
            resizableColumns:true,
            columns:[
                {title:"Rank", field:"rank", width:60, hozAlign:"center"},
                {title:"Maker", field:"maker"},
                {title:"Logo", field:"logo", formatter:"image", hozAlign:"center", cellClick:function(e,cell){
                    // optional hover zoom
                }, cellMouseOver:function(e,cell){
                    e.target.style.maxWidth = cell.getWidth() + "px";
                    e.target.style.maxHeight = cell.getHeight() + "px";
                }},
                {title:"Maker Type", field:"makerType"},
                {title:"Link", field:"link", formatter:"link", formatterParams:{labelField:"link", urlField:"link"}},
                {title:"Preview", field:"preview", formatter:function(cell){
                    const val = cell.getValue();
                    return `<span class="hover-preview" style="background-image:url(${val}); width:30px; height:30px;"></span>`;
                }, hozAlign:"center"},
                {title:"Specialty", field:"specialty", headerFilter:"input"},
                {title:"$ Price", field:"price", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val,colMinMax['price'].min,colMinMax['price'].max);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = getTextColor(val,colMinMax['price'].min,colMinMax['price'].max);
                    return val;
                }},
                {title:"Partials", field:"partials", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val,colMinMax['partials'].min,colMinMax['partials'].max,true);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = getTextColor(val,colMinMax['partials'].min,colMinMax['partials'].max);
                    return val;
                }},
                {title:"Fursuits", field:"fursuits", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val,colMinMax['fursuits'].min,colMinMax['fursuits'].max,true);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = getTextColor(val,colMinMax['fursuits'].min,colMinMax['fursuits'].max);
                    return val;
                }},
                {title:"Portfolio Size", field:"portfolio", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val,colMinMax['portfolio'].min,colMinMax['portfolio'].max,true);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = getTextColor(val,colMinMax['portfolio'].min,colMinMax['portfolio'].max);
                    return val;
                }},
                {title:"Followers", field:"followers", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val,colMinMax['followers'].min,colMinMax['followers'].max,true);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = getTextColor(val,colMinMax['followers'].min,colMinMax['followers'].max);
                    return val;
                }},
                {title:"Acct Age", field:"acctAge", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val,colMinMax['acctAge'].min,colMinMax['acctAge'].max);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = getTextColor(val,colMinMax['acctAge'].min,colMinMax['acctAge'].max);
                    return val;
                }},
                {title:"Status", field:"status"},
                {title:"Aesthetic", field:"aesthetic"},
                {title:"Timeline", field:"timeline"},
                {title:"Rank Score", field:"rankScore"},
                {title:"Imperfections", field:"imperfections"}
            ],
            rowFormatter:function(row){
                const el = row.getElement();
                if(row.getIndex()%2===0){
                    el.style.backgroundColor = "#2e2e2e";
                }else{
                    el.style.backgroundColor = "#383838";
                }
                el.style.color="#fff";
            }
        });
    }
});
</script>

</body>
</html>

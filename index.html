<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kemono Fursuit Makers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Tabulator CSS -->
<link href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator_midnight.min.css" rel="stylesheet">

<style>
  body {
    background: #2e2e2e;
    color: #fff;
    font-family: sans-serif;
    padding: 20px;
  }

  #creator-table {
    width: 95%;
    margin: auto;
    height: 85vh;
  }

  #logo-hover {
    position: absolute;
    display: none;
    width: 150px;
    height: 150px;
    border: 2px solid #fff;
    z-index: 9999;
    pointer-events: none;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }

  .tabulator .tabulator-header {
    background-color: #1f1f1f !important;
  }

  a {
    color: darkorange;
    text-decoration: none;
  }
  a:hover {
    color: orange;
  }
</style>
</head>
<body>

<h1>Kemono Fursuit Makers</h1>
<div id="creator-table"></div>
<div id="logo-hover"></div>

<script src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQesC2Kuwk-4S3ID4cCsCvOGM4U0DstvIoewGKQn4pZII8mkoa6fxcN18ozOO3_EkISGIkKNVngLYdN/pub?gid=131139777&single=true&output=csv";

function computeGradientColor(value, min, max, reverse=false){
    if(value == null || value === "") return null; // Do not apply gradient to blank cells
    const ratio = (value - min) / (max - min);
    let r,g,b;
    if(ratio <= 0.5){
        const t = ratio / 0.5;
        r = Math.round(46*(1-t) + 46*t);
        g = Math.round(46*(1-t) + 111*t);
        b = Math.round(46*(1-t) + 64*t);
    } else {
        const t = (ratio-0.5)/0.5;
        r = Math.round(46*(1-t) + 179*t);
        g = Math.round(111*(1-t) + 27*t);
        b = Math.round(64*(1-t) + 27*t);
    }
    if(reverse){
        // Flip ratio for columns where high = green
        r = 255 - r;
        g = 255 - g;
        b = 255 - b;
    }
    return `rgb(${r},${g},${b})`;
}

// Hover for logos
const hoverDiv = document.getElementById('logo-hover');
function attachHover(el, url){
    el.addEventListener('mouseenter', e=>{
        hoverDiv.style.backgroundImage = `url(${url})`;
        hoverDiv.style.display = 'block';
        hoverDiv.style.left = e.pageX + 20 + 'px';
        hoverDiv.style.top = e.pageY + 20 + 'px';
    });
    el.addEventListener('mousemove', e=>{
        hoverDiv.style.left = e.pageX + 20 + 'px';
        hoverDiv.style.top = e.pageY + 20 + 'px';
    });
    el.addEventListener('mouseleave', e=>{
        hoverDiv.style.display = 'none';
    });
}

Papa.parse(csvUrl, {
    download: true,
    header: true,
    dynamicTyping: true,
    complete: function(results) {
        const data = results.data.map(row => ({
            rank: row['Rank'],
            maker: row['Maker'],
            logo: row['Logo'],
            makerType: row['Maker Type'],
            link: row['Link'],
            preview: row['Preview'],
            price: row['$ Price'],
            partials: row['Partials'],
            fursuits: row['Fursuits'],
            portfolio: row['Portfolio Size'],
            acctAge: row['Acct Age'],
            status: row['Status'],
            aesthetic: row['Aesthetic'],
            specialty: row['Specialty'],
        }));

        // Calculate independent min/max for each gradient column
        const gradientColumns = ['price','partials','fursuits','portfolio','acctAge'];
        const colMinMax = {};
        gradientColumns.forEach(col=>{
            const vals = data.map(d=>d[col]).filter(v=>v!=null && !isNaN(v));
            colMinMax[col] = {min: Math.min(...vals), max: Math.max(...vals)};
        });

        const table = new Tabulator("#creator-table", {
            data: data,
            layout: "fitDataTable",
            movableColumns: true,
            resizableColumns: true,
            height: "85vh",
            placeholder: "No Data Available",
            columns: [
                {title:"Rank", field:"rank", width:60, hozAlign:"center"},
                {title:"Maker", field:"maker"},
                {title:"Logo", field:"logo", formatter:function(cell){
                    const val = cell.getValue();
                    if(!val) return "";
                    const img = document.createElement('img');
                    img.src = val;
                    img.style.height = '30px';
                    img.style.width = 'auto';
                    img.style.display = 'block';
                    img.style.margin = '0 auto';
                    attachHover(img, val);
                    return img;
                }, hozAlign:"center", width:60},
                {title:"Maker Type", field:"makerType"},
                {title:"Link", field:"link", formatter:"link", formatterParams:{labelField:"link", urlField:"link"}},
                {title:"Specialty", field:"specialty", headerFilter:"input"},
                {title:"$ Price", field:"price", hozAlign:"center", formatter:function(cell){
                    const val = cell.getValue();
                    if(val == null || val === "") return "";
                    const c = computeGradientColor(val, colMinMax['price'].min, colMinMax['price'].max);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Partials", field:"partials", hozAlign:"center", formatter:function(cell){
                    const val = cell.getValue();
                    if(val == null || val === "") return "";
                    const c = computeGradientColor(val, colMinMax['partials'].min, colMinMax['partials'].max, true);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Fursuits", field:"fursuits", hozAlign:"center", formatter:function(cell){
                    const val = cell.getValue();
                    if(val == null || val === "") return "";
                    const c = computeGradientColor(val, colMinMax['fursuits'].min, colMinMax['fursuits'].max, true);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Portfolio Size", field:"portfolio", hozAlign:"center", formatter:function(cell){
                    const val = cell.getValue();
                    if(val == null || val === "") return "";
                    const c = computeGradientColor(val, colMinMax['portfolio'].min, colMinMax['portfolio'].max, true);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Acct Age", field:"acctAge", hozAlign:"center", formatter:function(cell){
                    const val = cell.getValue();
                    if(val == null || val === "") return "";
                    const c = computeGradientColor(val, colMinMax['acctAge'].min, colMinMax['acctAge'].max, true);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Status", field:"status"},
                {title:"Aesthetic", field:"aesthetic"}
            ],
            rowFormatter:function(row){
                const el = row.getElement();
                el.style.borderBottom = "1px solid #fff";
                el.style.borderRight = "1px solid #fff";
                if(row.getIndex() %2 ===0){
                    el.style.backgroundColor = "#383838";
                } else {
                    el.style.backgroundColor = "#2e2e2e";
                }
            }
        });
    }
});
</script>
</body>
</html>

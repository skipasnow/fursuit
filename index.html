<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kemono Fursuit Makers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator_midnight.min.css" rel="stylesheet">

<style>
  body {
    background: #2e2e2e;
    color: #fff;
    font-family: sans-serif;
    padding: 20px;
  }

  #creator-table {
    width: 95%;
    margin: auto;
  }

  .tabulator .tabulator-header {
    background-color: #1f1f1f !important;
  }

  a { color: darkorange; text-decoration: none; }
  a:hover { color: orange; }

  .tabulator-cell, .tabulator-row {
    border: 1px solid white;
  }

  .logo-hover {
    position: absolute;
    z-index: 9999;
    border: 2px solid #fff;
    width: 150px;
    height: 150px;
    background-size: contain;
    background-repeat: no-repeat;
    pointer-events: none;
  }
</style>
</head>
<body>

<h1>Kemono Fursuit Makers</h1>
<div id="creator-table"></div>

<script src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQesC2Kuwk-4S3ID4cCsCvOGM4U0DstvIoewGKQn4pZII8mkoa6fxcN18ozOO3_EkISGIkKNVngLYdN/pub?gid=131139777&single=true&output=csv";

function lerpColor(color1, color2, t){
    const c1 = color1.match(/\w\w/g).map(x=>parseInt(x,16));
    const c2 = color2.match(/\w\w/g).map(x=>parseInt(x,16));
    const r = Math.round(c1[0]*(1-t)+c2[0]*t);
    const g = Math.round(c1[1]*(1-t)+c2[1]*t);
    const b = Math.round(c1[2]*(1-t)+c2[2]*t);
    return `rgb(${r},${g},${b})`;
}

// Convert hex to rgb numbers
function hexToRgb(hex){ return hex.replace(/^#/,'').match(/.{2}/g).map(x=>parseInt(x,16)); }

Papa.parse(csvUrl, { download:true, header:true, dynamicTyping:true, complete:function(results){
    const data = results.data;

    const gradientCols = {
        price: {reverse:false},
        partials: {reverse:true},
        fursuits: {reverse:true},
        portfolio: {reverse:true},
        acctAge: {reverse:true}
    };

    // Calculate min/max per column
    Object.keys(gradientCols).forEach(col=>{
        const values = data.map(d=>d[col]).filter(v=>v!=null && !isNaN(v));
        gradientCols[col].min = Math.min(...values);
        gradientCols[col].max = Math.max(...values);
    });

    function getColumnGradient(value, col){
        if(value===null || value===undefined || value==='') return '';
        const colInfo = gradientCols[col];
        const t = (value - colInfo.min)/(colInfo.max - colInfo.min);
        const midpoint = 0.5;
        const darkRow = '#2e2e2e';
        const green = '#2E6F40';
        const red = '#B31B1B';
        if(t < midpoint){
            return lerpColor(red, darkRow, t/midpoint);
        } else {
            return lerpColor(darkRow, green, (t-midpoint)/(1-midpoint));
        }
    }

    const table = new Tabulator("#creator-table", {
        data: data,
        layout: "fitData",
        movableColumns:true,
        resizableColumns:true,
        height:"85vh",
        columns:[
            {title:"Rank", field:"Rank", width:60, hozAlign:"center"},
            {title:"Maker", field:"Maker"},
            {title:"Logo", field:"Logo", formatter:"image", formatterParams:{height:30,width:30}, hozAlign:"center"},
            {title:"Maker Type", field:"Maker Type"},
            {title:"Link", field:"Link", formatter:"link", formatterParams:{labelField:"Link",urlField:"Link"}},
            {title:"Preview", field:"Preview"},
            {title:"Specialty", field:"Specialty", headerFilter:"input"},
            {title:"$ Price", field:"$ Price", hozAlign:"right", formatter:function(cell){
                const val = cell.getValue();
                cell.getElement().style.backgroundColor = getColumnGradient(val,'price');
                cell.getElement().style.color = "#fff";
                return val;
            }},
            {title:"Partials", field:"Partials", hozAlign:"right", formatter:function(cell){
                const val = cell.getValue();
                cell.getElement().style.backgroundColor = getColumnGradient(val,'partials');
                cell.getElement().style.color = "#fff";
                return val;
            }},
            {title:"Fursuits", field:"Fursuits", hozAlign:"right", formatter:function(cell){
                const val = cell.getValue();
                cell.getElement().style.backgroundColor = getColumnGradient(val,'fursuits');
                cell.getElement().style.color = "#fff";
                return val;
            }},
            {title:"Portfolio Size", field:"Portfolio Size", hozAlign:"right", formatter:function(cell){
                const val = cell.getValue();
                cell.getElement().style.backgroundColor = getColumnGradient(val,'portfolio');
                cell.getElement().style.color = "#fff";
                return val;
            }},
            {title:"Acct Age", field:"Acct Age", hozAlign:"right", formatter:function(cell){
                const val = cell.getValue();
                cell.getElement().style.backgroundColor = getColumnGradient(val,'acctAge');
                cell.getElement().style.color = "#fff";
                return val;
            }},
            {title:"Status", field:"Status"},
            {title:"Aesthetic", field:"Aesthetic"},
            {title:"Timeline", field:"Timeline"},
            {title:"Rank Score", field:"Rank Score"},
            {title:"Imperfections", field:"Imperfections"}
        ],
        rowFormatter:function(row){
            const el = row.getElement();
            el.style.backgroundColor = row.getIndex()%2===0 ? "#383838" : "#2e2e2e";
        }
    });

    // Floating logo hover
    table.on("cellMouseEnter", function(e, cell){
        if(cell.getColumn().getField() === "Logo"){
            const val = cell.getValue();
            if(!val) return;
            const hoverImg = document.createElement("div");
            hoverImg.className = "logo-hover";
            hoverImg.style.backgroundImage = `url(${val})`;
            document.body.appendChild(hoverImg);

            function moveHover(event){
                hoverImg.style.left = (event.pageX + 10) + "px";
                hoverImg.style.top = (event.pageY + 10) + "px";
            }

            moveHover(e);
            cell.getElement().addEventListener("mousemove", moveHover);
            cell.getElement().addEventListener("mouseleave", function(){
                hoverImg.remove();
            }, {once:true});
        }
    });
}});
</script>
</body>
</html>

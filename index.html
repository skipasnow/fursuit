<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kemono Fursuit Makers</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Tabulator CSS -->
<link href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator_midnight.min.css" rel="stylesheet">

<style>
  body {
    background: #2e2e2e;
    color: #fff;
    font-family: sans-serif;
    padding: 20px;
  }

  #creator-table {
    width: 95%;
    margin: auto;
  }

  /* Custom header color */
  .tabulator .tabulator-header {
    background-color: #1f1f1f !important;
  }

  /* URL styling */
  a {
    color: darkorange;
    text-decoration: none;
  }
  a:hover {
    color: orange;
  }

  /* Row borders */
  .tabulator-cell, .tabulator-row {
    border: 1px solid white;
  }

  /* Floating hover image style */
  .logo-hover {
    position: absolute;
    z-index: 9999;
    border: 2px solid #fff;
    width: 150px; /* size of hover preview */
    height: 150px;
    background-size: contain;
    background-repeat: no-repeat;
    pointer-events: none;
  }
</style>
</head>
<body>

<h1>Kemono Fursuit Makers</h1>
<div id="creator-table"></div>

<!-- Tabulator JS -->
<script src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQesC2Kuwk-4S3ID4cCsCvOGM4U0DstvIoewGKQn4pZII8mkoa6fxcN18ozOO3_EkISGIkKNVngLYdN/pub?gid=131139777&single=true&output=csv";

// Gradient helper
function getGradientColor(value, min, max, reverse=false){
    if(value === null || value === undefined || isNaN(value)) return ""; 
    const ratio = (value - min) / (max - min);
    const r = reverse ? Math.floor(179 + (46-179) * ratio) : Math.floor(46 + (179-46) * ratio);
    const g = reverse ? Math.floor(111 + (27-111) * ratio) : Math.floor(111 + (111-111) * ratio); // green channel stays
    const b = reverse ? Math.floor(64 + (27-64) * ratio) : Math.floor(64 + (27-64) * ratio); 
    return `rgb(${r},${g},${b})`;
}

Papa.parse(csvUrl, {
    download: true,
    header: true,
    dynamicTyping: true,
    complete: function(results) {
        const data = results.data.map(row => {
            return {
                rank: row['Rank'],
                maker: row['Maker'],
                logo: row['Logo'],
                makerType: row['Maker Type'],
                link: row['Link'],
                preview: row['Preview'],
                price: row['$ Price'],
                shipOrFly: row['$ Ship or Fly'],
                tariff: row['$ Tariff (2025)'],
                ship: row['$ Ship'],
                airTravel: row['$ Air Travel'],
                travelSurplus: row['$ Travel Surplus'],
                aesthetic: row['Aesthetic'],
                status: row['Status'],
                specialty: row['Specialty'],
                partials: row['Partials'],
                fursuits: row['Fursuits'],
                portfolio: row['Portfolio Size'],
                country: row['Country'],
                followers: row['Followers'],
                acctAge: row['Acct Age'],
                rep: row['Rep'],
                timeline: row['Timeline'],
                acctDate: row['Acct Date'],
                rankScore: row['Rank Score'],
                imperfections: row['Imperfections'],
                worksPerYear: row['Works Per Year'],
                worksRank: row['Works Rank'],
                followersRank: row['Followers Rank'],
                acctDateRank: row['Acct Date Rank'],
                partialsRank: row['Partials Rank'],
                fursuitsRank: row['Fursuits Rank'],
                priceRank: row['Price Rank']
            };
        });

        // Calculate min/max for gradient columns individually
        const gradientColumns = {
            price: {reverse:false},
            partials: {reverse:true},
            fursuits: {reverse:true},
            portfolio: {reverse:true},
            acctAge: {reverse:true}
        };

        Object.keys(gradientColumns).forEach(col=>{
            const values = data.map(d=>d[col]).filter(v=>v!=null && !isNaN(v));
            gradientColumns[col].min = Math.min(...values);
            gradientColumns[col].max = Math.max(...values);
        });

        const table = new Tabulator("#creator-table", {
            data: data,
            layout: "fitData",
            movableColumns: true,
            resizableColumns: true,
            height: "85vh",
            columns: [
                {title:"Rank", field:"rank", width:60, hozAlign:"center", headerFilter:false},
                {title:"Maker", field:"maker", headerFilter:false},
                {title:"Logo", field:"logo", formatter:"image", formatterParams:{height:30, width:30}, hozAlign:"center", headerFilter:false, cellClick:function(e, cell){
                    // optional: could zoom on click if desired
                }},
                {title:"Maker Type", field:"makerType", headerFilter:false},
                {title:"Link", field:"link", formatter:"link", formatterParams:{labelField:"link", urlField:"link"}, headerFilter:false},
                {title:"Preview", field:"preview", headerFilter:false},
                {title:"Specialty", field:"specialty", headerFilter:"input"},
                {title:"$ Price", field:"price", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val, gradientColumns.price.min, gradientColumns.price.max, gradientColumns.price.reverse);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Partials", field:"partials", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val, gradientColumns.partials.min, gradientColumns.partials.max, gradientColumns.partials.reverse);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Fursuits", field:"fursuits", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val, gradientColumns.fursuits.min, gradientColumns.fursuits.max, gradientColumns.fursuits.reverse);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Portfolio Size", field:"portfolio", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val, gradientColumns.portfolio.min, gradientColumns.portfolio.max, gradientColumns.portfolio.reverse);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Acct Age", field:"acctAge", hozAlign:"right", formatter:function(cell){
                    const val = cell.getValue();
                    const c = getGradientColor(val, gradientColumns.acctAge.min, gradientColumns.acctAge.max, gradientColumns.acctAge.reverse);
                    cell.getElement().style.backgroundColor = c;
                    cell.getElement().style.color = "#fff";
                    return val;
                }},
                {title:"Status", field:"status"},
                {title:"Aesthetic", field:"aesthetic"},
                {title:"Timeline", field:"timeline"},
                {title:"Rank Score", field:"rankScore"},
                {title:"Imperfections", field:"imperfections"}
            ],
            rowFormatter:function(row){
                const el = row.getElement();
                el.style.backgroundColor = row.getIndex() %2 ===0 ? "#383838" : "#2e2e2e";
            }
        });

        // Floating hover for logos
        table.on("cellMouseEnter", function(e, cell){
            if(cell.getColumn().getField() === "logo"){
                const val = cell.getValue();
                if(!val) return;
                const hoverImg = document.createElement("div");
                hoverImg.className = "logo-hover";
                hoverImg.style.backgroundImage = `url(${val})`;
                document.body.appendChild(hoverImg);

                function moveHover(event){
                    hoverImg.style.left = (event.pageX + 10) + "px";
                    hoverImg.style.top = (event.pageY + 10) + "px";
                }

                moveHover(e);

                cell.getElement().addEventListener("mousemove", moveHover);

                cell.getElement().addEventListener("mouseleave", function(){
                    hoverImg.remove();
                }, {once:true});
            }
        });
    }
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kemono Fursuit Makers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- External Libraries -->
    <link href="https://unpkg.com/tabulator-tables@5.6.0/dist/css/tabulator_midnight.min.css" rel="stylesheet">
    <script src="https://unpkg.com/tabulator-tables@5.6.0/dist/js/tabulator.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>

    <style>
        /* =========================================
           1. GLOBAL LAYOUT & DEFAULTS
           ========================================= */
        html {
            height: 100%;
            margin: 0;
            padding: 0;
            background: #2e2e2e;
            color: #fff;
            font-family: sans-serif;
        }

        body {
            height: 100%;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow: auto; 
        }

        h1 {
            margin: 0 0 15px 0;
            flex-shrink: 0;
        }

        /* --- HEADER ANIMATION --- */
        #header-text {
            display: inline-block;
            position: relative;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: left center;
            cursor: inherit;
        }

        #header-text:hover {
            transform: scale(1.15);
            background-image: linear-gradient(
                to right, 
                #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3, 
                #ff0000, #ff7f00, #ffff00
            );
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            animation: rainbow-move 2s linear infinite;
        }

        @keyframes rainbow-move { to { background-position: 200% center; } }

        .star-particle {
            position: fixed; top: 0; color: gold; font-size: 1.2em;
            pointer-events: none; z-index: 99999; user-select: none;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.8);
            animation: fall 1.5s linear forwards;
        }

        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
            100% { transform: translateY(300px) rotate(180deg) scale(0.5); opacity: 0; }
        }

        /* =========================================
           2. CONTROLS SECTION
           ========================================= */
        .controls-container {
            background: #1f1f1f; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 15px;
            display: flex; 
            gap: 20px; 
            align-items: flex-end; 
            flex-wrap: wrap; 
            border: 1px solid #444;
            flex-shrink: 0; 
        }

        .control-group { 
            display: flex; 
            flex-direction: column; 
            gap: 5px; 
        }

        select, button {
            padding: 8px 12px; 
            border-radius: 4px; 
            border: 1px solid #555;
            background: #333; 
            color: #fff; 
            /* Force pointer so buttons feel clickable */
            cursor: pointer; 
            font-size: 14px;
        }
        select:hover, button:hover { background: #444; border-color: darkorange; }
        button.reset-btn { background: #c62828; border-color: #e53935; }
        button.reset-btn:hover { background: #d32f2f; }
        label { font-weight: bold; color: #ccc; }

        /* --- RESULTS COUNTER --- */
        .results-counter {
            width: 100%;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #444; /* Separator line */
            font-size: 1.1em;
            text-align: center;
            color: #ccc;
        }
        .results-counter b {
            color: #ff8c00; /* Orange */
            font-size: 1.2em;
        }


        /* =========================================
           3. PRICE SLIDER STYLING
           ========================================= */
        .slider-group {
            /* FORCE FULL WIDTH ROW */
            flex: 0 0 100% !important; 
            width: 100% !important; 
            order: -1; 
            
            /* FIX: Limit width so it doesn't stretch across ultrawide monitors */
            max-width: 600px; 
            
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            
            /* Spacing */
            padding: 0 15px; 
            margin-bottom: 40px; /* Room for Pips */
        }

        /* The Track */
        .noUi-target {
            background: #555;
            border: 1px solid #000;
            border-radius: 4px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.5);
            height: 8px;
            margin-top: 10px;
            cursor: pointer;
        }

        /* The Connect Bar (Range) */
        .noUi-connect {
            background: #ff8c00 !important; 
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
            transition: background 0.2s;
        }

        /* The Handles (Knobs) */
        .noUi-handle {
            width: 24px !important; 
            height: 24px !important;
            border-radius: 50%; 
            top: -9px !important; 
            right: -12px !important; 
            
            background: #eee;
            border: 2px solid #ff8c00;
            box-shadow: 0 2px 6px rgba(0,0,0,0.6);
            cursor: grab;
            outline: none;

            /* Teleport/Pulse Animation */
            transition: left 0.1s ease-out, transform 0.1s ease, opacity 0.1s ease;
        }

        .noUi-handle:before, .noUi-handle:after { display: none; }

        /* Active State */
        .noUi-handle.noUi-active {
            background: #ff8c00;
            border-color: #fff;
            cursor: grabbing;
            transform: scale(1.3);
            opacity: 0.5; /* Phase Shift Effect */
            box-shadow: 0 0 0 6px rgba(255, 140, 0, 0.3), 0 0 20px #ff8c00;
        }

        /* Visual Ticks (Pips) */
        .noUi-pips {
            font-family: sans-serif;
            font-size: 11px;
            color: #aaa;
            height: 30px;
            top: 12px;
        }
        /* Small ticks */
        .noUi-marker { background: #555; width: 1px; } 
        /* Large ticks */
        .noUi-marker-large { background: #aaa; height: 10px; width: 2px; } 
        /* Numbers */
        .noUi-value { color: #ccc; margin-top: 5px; }


        /* =========================================
           4. DATA GRID / TABLE
           ========================================= */
        #creator-table {
            width: 100%; 
            max-width: 100%; 
            flex-grow: 1; 
            border: 1px solid #444;
        }

        .tabulator .tabulator-header { background-color: #1f1f1f !important; font-weight: bold !important; overflow: hidden !important; cursor: inherit; }
        .tabulator .tabulator-header .tabulator-col-content { white-space: normal !important; padding: 8px 4px; cursor: inherit; }
        .tabulator .tabulator-header .tabulator-header-filter { height: auto !important; overflow: visible !important; margin-top: 5px; }
        .tabulator .tabulator-row .tabulator-cell { border: 1px solid #444; }
        .tabulator .tabulator-row:nth-child(even) { background-color: #383838; }
        .tabulator .tabulator-row:nth-child(odd) { background-color: #2e2e2e; }

        /* Base Cell */
        .tabulator-row .tabulator-cell {
            transition: transform 0.1s ease-out, filter 0.2s ease, box-shadow 0.2s ease;
            position: relative; background-clip: padding-box; overflow: hidden; cursor: inherit;
        }

        /* Active Tilt Effect */
        .tabulator-row .tabulator-cell.active-tilt {
            z-index: 10000 !important; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.6);
            border-color: rgba(255,255,255,0.5) !important; 
            filter: brightness(1.2); 
            overflow: visible !important; 
        }

        /* 3D Text Wrapper */
        .text-wrapper {
            display: block; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            transition: all 0.2s ease; transform-origin: center center; box-sizing: border-box;
        }
        .tabulator-row .tabulator-cell.active-tilt .text-wrapper {
            position: absolute; left: 0; top: 50%;
            min-width: 100%; width: max-content; 
            background-color: rgba(40, 40, 40, 0.95);
            padding: 12px 20px; min-height: 45px; display: flex; align-items: center;
            border-radius: 4px; box-shadow: 0 10px 25px rgba(0,0,0,0.7); 
            z-index: 100; pointer-events: auto; border: 1px solid #ffffff;
        }

        /* Shine Sweep Text */
        .text-content { color: #fff; font-weight: normal; transition: font-weight 0.2s ease; }
        .tabulator-row .tabulator-cell.active-tilt .text-content {
            font-weight: bold;
            background: linear-gradient(110deg, #ffffff 40%, #ff8c00 50%, #ffffff 60%);
            background-size: 200% 100%; background-position: 200% center;
            -webkit-background-clip: text; background-clip: text;
            -webkit-text-fill-color: transparent; color: transparent;
            animation: shine-sweep 1.5s linear infinite;
        }
        @keyframes shine-sweep { 0% { background-position: 200% center; } 100% { background-position: -200% center; } }

        /* Links */
        a { color: darkorange !important; text-decoration: none; transition: all 0.2s; cursor: pointer; }
        .tabulator-row .tabulator-cell.active-tilt a {
            display: inline-block; color: #ffd699 !important;
            transform: translateY(-4px) scale(1.2);
            text-shadow: 0 0 8px rgba(255, 140, 0, 0.8), 0 0 15px rgba(255, 140, 0, 0.6);
            position: relative; z-index: 10001;
        }


        /* =========================================
           5. SPECIALTY TAGS & FILTERS
           ========================================= */
        .tag-wrapper { display: flex; flex-wrap: wrap; gap: 4px; align-items: center; }
        .specialty-tag {
            background-color: #444; color: #fff; padding: 2px 6px;
            border-radius: 4px; font-size: 0.85em; cursor: pointer;
            border: 1px solid #555; transition: all 0.2s ease; font-weight: normal;
        }
        .specialty-tag:hover { background-color: darkorange; border-color: #fff; transform: scale(1.1); }

        .filter-container {
            display: flex; flex-direction: column; gap: 6px; padding: 8px;
            background: #222; border-radius: 4px; width: 100%; box-sizing: border-box; 
            min-height: 100px; padding-bottom: 14px; 
        }
        .filter-input {
            background: #333; color: #fff; border: 1px solid #555;
            padding: 5px 8px; border-radius: 3px; font-size: 0.9em;
            width: 100%; outline: none; box-sizing: border-box; cursor: inherit !important;
        }
        .filter-input:focus { border-color: darkorange; }
        .filter-tag {
            background-color: darkorange; color: #fff; padding: 2px 6px;
            border-radius: 4px; font-size: 0.8em; display: inline-flex; align-items: center; gap: 4px;
            animation: popIn 0.2s ease-out; margin-right: 3px; margin-bottom: 3px;
        }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        .filter-remove { cursor: pointer; font-weight: bold; color: #000; font-size: 10px; }
        .filter-remove:hover { color: #fff; }
        .filter-actions {
              margin-top: auto; width: 100%; display: flex; justify-content: space-between; align-items: center; 
              border-top: 1px solid #444; padding-top: 8px; padding-bottom: 4px; line-height: 1.5;
        }
        .filter-clear-all { font-size: 0.85em; color: #ff6b6b; cursor: pointer; text-decoration: underline; white-space: nowrap; line-height: 1.5; }
        .filter-clear-all:hover { color: #ff4040; }
        .filter-apply-btn { font-size: 0.85em; color: #4caf50; cursor: pointer; text-decoration: underline; white-space: nowrap; font-weight: bold; line-height: 1.5; }
        .filter-apply-btn:hover { color: #66bb6a; }
        .tags-area { display: flex; flex-wrap: wrap; gap: 3px; width: 100%; margin-bottom: 4px; }


        /* =========================================
           6. IMAGES & TOOLTIPS
           ========================================= */
        /* Thumbnails */
        .preview-box, .logo-box {
            display: inline-block; width: 30px; height: 30px;
            background-color: #444;
            background-image: linear-gradient(45deg, #555 25%, transparent 25%, transparent 75%, #555 75%, #555), 
                              linear-gradient(45deg, #555 25%, transparent 25%, transparent 75%, #555 75%, #555);
            background-size: 10px 10px; background-position: 0 0, 5px 5px;
            border-radius: 4px; cursor: pointer; border: 1px solid #555; box-sizing: border-box;
            background-repeat: no-repeat;
        }
        .preview-box:hover, .logo-box:hover { border-color: darkorange; box-shadow: 0 0 5px rgba(255,140,0,0.5); }
        .logo-box { background-size: cover; background-position: center; }
        .preview-container { touch-action: none; position: relative; display: inline-flex; }

        /* Large Floating Tooltip */
        #image-tooltip {
            display: none; 
            position: fixed; z-index: 99999; pointer-events: none;
            width: 400px; height: 400px;
            background-color: #222; border: 2px solid #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.7); 
            background-size: contain; background-repeat: no-repeat; background-position: center;
            opacity: 0; transition: opacity 0.25s ease-out, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            flex-direction: column; justify-content: flex-end; align-items: center;        
        }

        /* Ghost HUD (The Orange Dots) */
        .tooltip-hud {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; z-index: 2147483647; pointer-events: none;
            background: rgba(0, 0, 0, 0.85); padding: 10px 15px;
            border-radius: 50px; border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .hud-box {
            width: 12px; height: 12px; border-radius: 50%;
            background-color: #444; border: 2px solid #888; box-shadow: 0 0 2px #000;
            transition: all 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .hud-box.active {
            background-color: #ff8c00; border-color: #fff;
            box-shadow: 0 0 0 2px #000, 0 0 10px #ff8c00, 0 0 20px #ff8c00;
            transform: scale(1.6);
        }


        /* =========================================
           7. CURSORS & FX (FIXED)
           ========================================= */
        /* FIX 1: REMOVED !important so it can be overridden by :active */
        html, body, *, p, span, h1, h2, h3, h4, h5, h6, blockquote, pre, div {
            cursor: url('data:image/png;base64,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') 0 0, auto;
        }

        /* FIX 2: Kept !important here to ensure click overrides hover/default */
        html:active, body:active, *:active, 
        p:active, span:active, h1:active, h2:active, h3:active, h4:active, h5:active, h6:active, div:active {
            cursor: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAfCAYAAACGVs+MAAAGMGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpDb2xvclNwYWNlPSIxIgogICBleGlmOlBpeGVsWERpbWVuc2lvbj0iMzIiCiAgIGV4aWY6UGl4ZWxZRGltZW5zaW9uPSIzMSIKICAgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIKICAgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIgogICB0aWZmOkltYWdlTGVuZ3RoPSIzMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMiIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIKICAgdGlmZjpYUmVzb2x1dGlvbj0iOTYvMSIKICAgdGlmZjpZUmVzb2x1dGlvbj0iOTYvMSIKICAg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') 0 0, auto !important;
        }

        ::selection {
            background-color: #ffcc00; 
            color: #000;
        }

        /* --- PAW PRINT TRAIL FX --- */
        .paw-trail {
            position: fixed; 
            width: 24px;
            height: 24px;
            opacity: 0.6;
            pointer-events: none; 
            z-index: 2147483647;        
            background-color: transparent; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='%23ff8c00' d='M226.5 92.9c14.3 42.9-.3 86.2-32.6 96.8s-70.1-15.6-84.4-58.5.3-86.2 32.6-96.8 70.1 15.6 84.4 58.5zM100.4 119.9c14.3 42.9-.3 86.2-32.6 96.8s-70.1-15.6-84.4-58.5.3-86.2 32.6-96.8 70.1 15.6 84.4 58.5zM341.5 24.7c-2.2 4.1-18 45-45 45-27 0-42.8-40.9-45-45-3.2-5.8 2.7-12.4 8.5-10.3 24 8.8 57.2 8.8 81.5 0 5.8-2.1 11.7 4.5 8.5 10.3zM480 119.9c-14.3 42.9-52.1 69.1-84.4 58.5s-46.9-53.9-32.6-96.8 52.1-69.1 84.4-58.5 46.9 53.9 32.6 96.8zM411.5 224.7c-31.8-31.8-82.3-29-113.5 4.3-27.7 29.6-39.7 68.8-15.7 103.4 19.3 27.8 39.3 38.1 39.3 38.1 33.9 15.3 60.1 22.5 83.6 11 21.7-10.7 33.9-32.9 36.6-60.2 2.7-27.4-7.9-64.7-30.3-96.6zM94 370.5c23.5 11.5 49.7 4.3 83.6-11 0 0 20-10.3 39.3-38.1 24-34.6 12-73.8-15.7-103.4-31.2-33.3-81.7-36.1-113.5-4.3-22.4 31.9-33 69.2-30.3 96.6 2.7 27.3 14.9 49.5 36.6 60.2z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            animation: pawFade 1.2s linear forwards;
            transform: rotate(var(--angle)) scaleX(var(--flip));
        }

        @keyframes pawFade {
            0% { opacity: 0.6; transform: rotate(var(--angle)) scaleX(var(--flip)) scale(1); }
            100% { opacity: 0; transform: rotate(var(--angle)) scaleX(var(--flip)) scale(0.5); }
        }
    </style>
</head>
<body>

    <h1><span id="header-text">Kemono Fursuit Makers</span></h1>

    <div class="controls-container">
      
      <div class="control-group slider-group">
        <div style="display:flex; justify-content:space-between; align-items:center; width:100%; margin-bottom:10px;">
            <label>
                Price: <span id="price-values" style="color:#ff8c00; font-weight:normal;">$2,000 - $10,000</span>
                <button id="reset-price-btn" style="padding:2px 6px; margin-left:5px; font-size:0.8em; background:#444; border:1px solid #666; cursor:pointer;" title="Reset Price">↺</button>
            </label>
            <label style="font-size:0.8em; display:flex; align-items:center; gap:5px; cursor:pointer; user-select:none;">
                <input type="checkbox" id="show-na-prices" checked> Show N/A
            </label>
        </div>
        <div id="price-slider"></div>
      </div>

      <div class="control-group">
        <label>Quick Sort:</label>
        <select id="sort-field">
          <option value="rank">Rank (Default)</option>
          <option value="price">Price</option>
          <option value="portfolio">Portfolio Size</option>
          <option value="followers">Followers</option>
          <option value="acctAge">Account Age</option>
          <option value="partials">Partials Count</option>
          <option value="fursuits">Fursuits Count</option>
        </select>
      </div>

      <div class="control-group">
        <label>Order:</label>
        <select id="sort-dir">
          <option value="asc">Low to High (Asc)</option>
          <option value="desc">High to Low (Desc)</option>
        </select>
      </div>

      <button id="reset-sort" class="reset-btn">Reset Sort</button>
      
      <div style="margin-left: auto; font-size: 0.9em; color: #aaa; width: 100%; margin-top:10px;">
        *Hold <b>Shift</b> and click column headers to sort by multiple columns at once.
      </div>

      <div id="results-counter" class="results-counter">
          Loading data...
      </div>

    </div>

    <div id="image-tooltip"></div>
    <div id="creator-table"></div>

    <script>
        // ==========================================
        // 1. PAW TRAIL LOGIC
        // ==========================================
        let trailX = 0;
        let trailY = 0;
        let stepCount = 0;
        const stepLength = 30; 

        console.log("Initializing Paw Trail...");

        document.addEventListener('mousemove', function(e) {
            const dist = Math.hypot(e.clientX - trailX, e.clientY - trailY);
            if (dist > stepLength) {
                createPaw(e.clientX, e.clientY, trailX, trailY);
                trailX = e.clientX;
                trailY = e.clientY;
            }
        });

        function createPaw(x, y, lastX, lastY) {
            const paw = document.createElement('div');
            paw.className = 'paw-trail';
            const angle = Math.atan2(y - lastY, x - lastX) * 180 / Math.PI + 90;
            stepCount++;
            const isRightFoot = stepCount % 2 === 0;
            
            paw.style.setProperty('--angle', `${angle}deg`);
            paw.style.setProperty('--flip', isRightFoot ? 1 : -1);
            paw.style.left = (x - 12) + 'px';
            paw.style.top = (y - 12) + 'px';

            document.documentElement.appendChild(paw);
            setTimeout(() => { paw.remove(); }, 1200);
        }


        // ==========================================
        // 2. MAIN APP LOGIC
        // ==========================================
        const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQesC2Kuwk-4S3ID4cCsCvOGM4U0DstvIoewGKQn4pZII8mkoa6fxcN18ozOO3_EkISGIkKNVngLYdN/pub?gid=131139777&single=true&output=csv";

        // --- TOOLTIP LOGIC ---
        const tooltipEl = document.getElementById("image-tooltip");
        let currentPreviewImages = [];
        let currentImageIndex = 0;
        let slideshowInterval;
        let hideTimeout; 
        let isTooltipCentered = false; 

        function displayImageInTooltip(imageUrl, forceAnimation = false) {
            if (!imageUrl) { tooltipEl.style.backgroundImage = 'none'; return; }
            const baseTransform = isTooltipCentered ? "translate(-50%, -50%)" : "";
            if (tooltipEl.style.opacity === '0' || forceAnimation) {
                const startAngle = Math.random() < 0.5 ? -5 : 5;
                tooltipEl.style.transition = 'none';
                tooltipEl.style.opacity = '0';
                tooltipEl.style.transform = `${baseTransform} rotate(${startAngle}deg) scale(0.95)`;
            }
            const img = new Image();
            img.onload = () => {
                if (tooltipEl.style.display !== 'none') {
                    tooltipEl.style.backgroundImage = `url('${imageUrl}')`;
                    void tooltipEl.offsetWidth; 
                    tooltipEl.style.transition = 'opacity 0.25s ease-out, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    tooltipEl.style.opacity = '1';
                    tooltipEl.style.transform = `${baseTransform} rotate(0deg) scale(1)`;
                }
            };
            img.src = imageUrl;
        }

        // HUD Helper
        function updateHudHighlight(index) {
            const hudContainer = tooltipEl.querySelector('.tooltip-hud');
            if (!hudContainer) return;
            const boxes = hudContainer.children;
            for (let i = 0; i < boxes.length; i++) {
                if (i === index) boxes[i].classList.add('active');
                else boxes[i].classList.remove('active');
            }
        }

        // Show Tooltip (with Enable HUD Toggle)
        function showTooltip(imageUrls, startIndex = 0, forceAnimation = false, enableHud = true) {
            if (!imageUrls || imageUrls.length === 0) { hideTooltip(); return; }
            
            const isContentDifferent = !currentPreviewImages.length || currentPreviewImages[0] !== imageUrls[0];

            currentPreviewImages = imageUrls;
            currentImageIndex = startIndex;
            tooltipEl.style.display = "flex"; 

            const existingHud = tooltipEl.querySelector('.tooltip-hud');
            
            if (enableHud) {
                if (isContentDifferent || !existingHud) {
                    if (existingHud) existingHud.remove();
                    const hud = document.createElement('div');
                    hud.className = 'tooltip-hud';
                    imageUrls.forEach((_, i) => {
                        const box = document.createElement('div');
                        box.className = 'hud-box';
                        hud.appendChild(box);
                    });
                    tooltipEl.appendChild(hud);
                }
                updateHudHighlight(startIndex);
            } else {
                if (existingHud) existingHud.remove();
            }
            displayImageInTooltip(currentPreviewImages[currentImageIndex], forceAnimation);
        }

        function hideTooltip() {
            clearTimeout(hideTimeout);
            clearInterval(slideshowInterval);
            hideTimeout = setTimeout(() => {
                tooltipEl.style.opacity = '0';
                setTimeout(() => {
                     if(tooltipEl.style.opacity === '0') {
                         tooltipEl.style.display = "none";
                         tooltipEl.style.backgroundImage = 'none';
                         tooltipEl.textContent = ''; 
                         currentPreviewImages = [];
                         currentImageIndex = 0;
                     }
                }, 200);
            }, 50);
        }

        function startSlideshow() {
            clearInterval(slideshowInterval);
            if (currentPreviewImages.length > 1) {
                slideshowInterval = setInterval(() => {
                    currentImageIndex = (currentImageIndex + 1) % currentPreviewImages.length;
                    displayImageInTooltip(currentPreviewImages[currentImageIndex], true);
                }, 2000);
            }
        }

        // Positioning
        function centerTooltip() {
            isTooltipCentered = true;
            tooltipEl.style.top = "50%";
            tooltipEl.style.left = "50%";
            tooltipEl.style.width = "80vh"; tooltipEl.style.height = "80vh";
        }
        function moveTooltip(e) {
            isTooltipCentered = false;
            const tooltipSize = 200; const offset = 15; 
            const windowHeight = window.innerHeight;
            tooltipEl.style.width = tooltipSize + "px"; tooltipEl.style.height = tooltipSize + "px";
            let left = e.clientX + offset; let top = e.clientY + offset;
            if (top + tooltipSize > windowHeight) { top = e.clientY - tooltipSize - offset; }
            tooltipEl.style.left = left + "px"; tooltipEl.style.top = top + "px";
        }

        // Specialty Filters
        let pendingSpecialtyFilters = new Set();
        let appliedSpecialtyFilters = new Set();

        window.addSpecialtyFilter = function(tag) {
            if(!tag) return;
            pendingSpecialtyFilters.add(tag.trim());
            updateFilterHeader();
            triggerHeaderResize(); 
        }

        window.removeSpecialtyFilter = function(tag) {
            pendingSpecialtyFilters.delete(tag);
            updateFilterHeader();
            triggerHeaderResize(); 
        }

        window.clearSpecialtyFilters = function() {
            pendingSpecialtyFilters.clear();
            appliedSpecialtyFilters.clear(); 
            updateFilterHeader();
            triggerHeaderResize();
            table.setHeaderFilterValue("specialty", []); 
        }

        window.applySpecialtyFilters = function() {
            appliedSpecialtyFilters = new Set(pendingSpecialtyFilters);
            table.setHeaderFilterValue("specialty", Array.from(appliedSpecialtyFilters));
            triggerHeaderResize();
        }

        function triggerHeaderResize() {
            if(table) {
                setTimeout(() => {
                     table.columnManager.renderer.renderColumns();
                     table.redraw(true);
                }, 50);
            }
        }

        function updateFilterHeader() {
            const container = document.getElementById('specialty-filter-container');
            if(!container) return;
            let tagsArea = container.querySelector('.tags-area');
            if (!tagsArea) {
                container.innerHTML = '';
                const input = document.createElement("input");
                input.type = "text";
                input.className = "filter-input";
                input.placeholder = "+ Type tag...";
                input.addEventListener("keydown", function(e){
                    if(e.key === "Enter"){
                        addSpecialtyFilter(this.value);
                        this.value = "";
                    }
                });
                container.appendChild(input);
                tagsArea = document.createElement("div");
                tagsArea.className = "tags-area";
                container.appendChild(tagsArea);
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'filter-actions';
                const applyBtn = document.createElement('span');
                applyBtn.className = 'filter-apply-btn';
                applyBtn.innerText = 'Apply Filter';
                applyBtn.onclick = window.applySpecialtyFilters;
                actionsDiv.appendChild(applyBtn);
                const clearBtn = document.createElement('span');
                clearBtn.className = 'filter-clear-all';
                clearBtn.innerText = 'Clear All';
                clearBtn.onclick = window.clearSpecialtyFilters;
                actionsDiv.appendChild(clearBtn);
                container.appendChild(actionsDiv);
            } 
            tagsArea.innerHTML = '';
            if (pendingSpecialtyFilters.size > 0) {
                pendingSpecialtyFilters.forEach(tag => {
                    const pill = document.createElement('span');
                    pill.className = 'filter-tag';
                    pill.innerHTML = `${tag} <span class="filter-remove" onclick="removeSpecialtyFilter('${tag}')">✕</span>`;
                    tagsArea.appendChild(pill);
                });
            } else {
                tagsArea.innerHTML = '<span style="color:#666; font-size:0.8em;">No tags selected</span>';
            }
        }

        // Helpers
        function parseImageFormula(formula) {
          if(!formula) return "";
          const match = formula.match(/=IMAGE\("(.+)"\)/);
          return match ? match[1] : formula;
        }
        function parsePreviewImages(urlsString) {
            if (!urlsString || typeof urlsString !== 'string') return [];
            return urlsString.split(/[\s,]+/)
                .map(url => url.trim())
                .filter(url => url.length > 0 && url.toLowerCase().startsWith('http'));
        }
        function cleanNumber(val) {
            if (val === null || val === undefined || val === "") return null;
            if (typeof val === 'string') {
                const cleaned = val.replace(/[$,\s]/g, '');
                if(cleaned === "") return null;
                const num = parseFloat(cleaned);
                return isNaN(num) ? null : num;
            }
            return val; 
        }
        function getGradientColor(value, min, max, lowIsGreen=false){
            if(value === null || value === undefined || value === "" || isNaN(value)) return "";
            const ratio = (value - min)/(max - min);
            const cappedRatio = Math.min(Math.max(ratio,0),1);
            let r,g;
            if(lowIsGreen){
                r = Math.floor(179 * cappedRatio + 46 * (1-cappedRatio)); 
                g = Math.floor(27 * cappedRatio + 111 * (1-cappedRatio)); 
            } else {
                r = Math.floor(46 * cappedRatio + 179 * (1-cappedRatio));
                g = Math.floor(111 * cappedRatio + 27 * (1-cappedRatio));
            }
            return `rgb(${r},${g},0)`;
        }
        function formatTextCell(cell) {
            const val = cell.getValue();
            if(val === null || val === undefined) return "";
            return `<div class="text-wrapper"><span class="text-content">${val}</span></div>`;
        }

        const headerText = document.getElementById('header-text');
        let starInterval;
        function createStar() {
            const star = document.createElement('div');
            star.className = 'star-particle';
            star.textContent = '★';
            const startX = Math.random() * window.innerWidth;
            const headerRect = headerText.getBoundingClientRect();
            const startY = headerRect.bottom - 10; 
            star.style.left = startX + 'px'; star.style.top = startY + 'px';
            const size = 0.8 + Math.random() * 0.8;
            star.style.fontSize = size + 'em';
            document.body.appendChild(star);
            setTimeout(() => { star.remove(); }, 1500);
        }
        headerText.addEventListener('mouseenter', () => { starInterval = setInterval(createStar, 50); });
        headerText.addEventListener('mouseleave', () => { clearInterval(starInterval); });

        // --- MAIN LOGIC ---
        let table;

        // Helper to update the results counter text (FIXED TYPO)
        function updateResultCounter(activeCount, totalCount) {
            const el = document.getElementById("results-counter");
            if(el) {
                el.innerHTML = `Makers matching criteria: <b>${activeCount}</b> <span style="font-size:0.8em; color:#666;">(of ${totalCount})</span>`;
            }
        }

        Papa.parse(csvUrl, {
            download: true, header: true, dynamicTyping: true,
            complete: function(results) {
                const data = results.data.map(row => ({
                    rank: cleanNumber(row['Rank']),
                    maker: row['Maker'],
                    logo: parseImageFormula(row['Logo']),
                    makerType: row['Maker Type'],
                    link: row['Link'],
                    previewImages: parsePreviewImages(row['Preview']), 
                    price: cleanNumber(row['$ Price']),
                    shipOrFly: cleanNumber(row['$ Ship or Fly']),
                    tariff: cleanNumber(row['$ Tariff (2025)']),
                    ship: cleanNumber(row['$ Ship']),
                    airTravel: cleanNumber(row['$ Air Travel']),
                    travelSurplus: cleanNumber(row['$ Travel Surplus']),
                    aesthetic: row['Aesthetic'],
                    status: row['Status'],
                    specialty: row['Specialty'],
                    partials: cleanNumber(row['Partials']),
                    fursuits: cleanNumber(row['Fursuits']),
                    portfolio: cleanNumber(row['Portfolio Size']),
                    country: row['Country'],
                    followers: cleanNumber(row['Followers']), 
                    acctAge: cleanNumber(row['Acct Age']),
                    acctDate: row['Acct Date'],
                    rep: row['Rep'],
                    timeline: row['Timeline'],
                    rankScore: cleanNumber(row['Rank Score']),
                    imperfections: cleanNumber(row['Imperfections']),
                    worksPerYear: cleanNumber(row['Works Per Year']),
                    worksRank: cleanNumber(row['Works Rank']),
                    followersRank: cleanNumber(row['Followers Rank']),
                    acctDateRank: cleanNumber(row['Acct Date Rank']),
                    partialsRank: cleanNumber(row['Partials Rank']),
                    fursuitsRank: cleanNumber(row['Fursuits Rank']),
                    priceRank: cleanNumber(row['Price Rank']),
                })).filter(row => row.maker); 

                if (data.length === 0) { 
                    const el = document.getElementById("results-counter");
                    if(el) el.innerHTML = "<span style='color:red'>Error: No data found or CSV failed to load.</span>";
                    console.warn("Data array is empty."); 
                    return; 
                }

                const colMinMax = {};
                const gradientColumns = ['price','partials','fursuits','portfolio','acctAge','followers'];
                gradientColumns.forEach(col=>{
                    const vals = data.map(d=>d[col]).filter(v=>v!==null && v!=="" && !isNaN(v));
                    // Prevent Math.min/max on empty arrays from returning Infinity
                    if(vals.length > 0) {
                        colMinMax[col] = {min: Math.min(...vals), max: Math.max(...vals)};
                    } else {
                        colMinMax[col] = {min: 0, max: 1};
                    }
                });

                // --- TABULATOR INIT ---
                table = new Tabulator("#creator-table", {
                    data: data,
                    layout: "fitData",
                    movableColumns: true,
                    resizableColumns: true,
                    placeholder:"No Data Available",
                    height:"100%", 
                    initialSort:[ {column:"rank", dir:"asc"} ],
                    
                    // --- COUNTER EVENTS ---
                    // Updates whenever filters change
                    dataFiltered: function(filters, rows) {
                        // Use the raw data length for total count to allow updates before table is fully rendered
                        const total = data.length; 
                        const active = rows.length;
                        updateResultCounter(active, total);
                    },

                    // --- INITIALIZE SLIDER AFTER TABLE IS BUILT ---
                    tableBuilt: function() {
                        // 1. Initial Count Update
                        updateResultCounter(data.length, data.length);

                        // 2. Slider Initialization
                        const slider = document.getElementById('price-slider');
                        const priceLabel = document.getElementById('price-values');
                        const naCheckbox = document.getElementById('show-na-prices');
                        const resetPriceBtn = document.getElementById('reset-price-btn');

                        if (slider && typeof noUiSlider !== 'undefined') {
                            noUiSlider.create(slider, {
                                start: [2000, 10000], 
                                connect: true,        
                                range: { 'min': 2000, 'max': 10000 },
                                step: 500,            
                                tooltips: false, 
                                pips: {
                                    mode: 'steps',
                                    density: 6.25,
                                    filter: function (value, type) {
                                        // Large lines for 2k steps
                                        if (value % 2000 === 0) return 1; 
                                        return 0; 
                                    },
                                    format: {
                                        to: function (value) { return '$' + (value / 1000) + 'k'; }
                                    }
                                },
                                format: {
                                    to: function (value) { return Math.round(value); },
                                    from: function (value) { return Number(value); }
                                }
                            });

                            const updateTableFilter = () => {
                                const values = slider.noUiSlider.get();
                                const min = parseInt(values[0]);
                                const max = parseInt(values[1]);
                                const showNA = naCheckbox.checked;

                                priceLabel.innerText = `$${min.toLocaleString()} - $${max.toLocaleString()}`;

                                table.setFilter(function(row){
                                    if (typeof row.price !== 'number') {
                                        return showNA; 
                                    }
                                    return row.price >= min && row.price <= max;
                                });
                            };

                            // Bind Events
                            slider.noUiSlider.on('update', updateTableFilter);
                            naCheckbox.addEventListener('change', updateTableFilter);
                            
                            if(resetPriceBtn) {
                                resetPriceBtn.addEventListener('click', function(){
                                    slider.noUiSlider.set([2000, 10000]);
                                    naCheckbox.checked = true;
                                    // Manually trigger update
                                    const values = slider.noUiSlider.get(); 
                                    priceLabel.innerText = `$${parseInt(values[0]).toLocaleString()} - $${parseInt(values[1]).toLocaleString()}`;
                                    table.recalc(); 
                                    updateTableFilter(); 
                                });
                            }

                            // Global Reset Hook
                            document.getElementById("reset-sort").addEventListener("click", function(){
                                table.clearSort(); 
                                table.setSort("rank", "asc"); 
                                table.clearHeaderFilter(); 
                                document.getElementById("sort-field").value = "rank";
                                document.getElementById("sort-dir").value = "asc";
                                window.clearSpecialtyFilters(); 
                                
                                slider.noUiSlider.set([2000, 10000]);
                                naCheckbox.checked = true;
                                // Force update logic
                                updateTableFilter();
                            });
                        }
                    },

                    columns: [
                        { title:"Rank", field:"rank", width:80, hozAlign:"center", sorter:"number", formatter: formatTextCell, cssClass: "text-cell" },
                        { title:"Maker", field:"maker", formatter: formatTextCell, cssClass: "text-cell" },
                        {
                            title:"Logo", field:"logo", hozAlign:"center", width:90, 
                            formatter:function(cell){
                                const val = cell.getValue();
                                return val ? `<div class="logo-box" style="background-image:url('${val}');"></div>` : "";
                            }
                        },
                        { title:"Maker Type", field:"makerType", formatter: formatTextCell, cssClass: "text-cell" },
                        {
                            title:"Link", field:"link", formatter:"link", hozAlign:"center",
                            formatterParams:{ labelField:"link", urlField:"link", target:"_blank" }
                        },
                        {
                            title: "Preview", 
                            field: "previewImages", 
                            hozAlign: "center", 
                            width: 200,
                            formatter: function(cell) {
                                const imageUrls = cell.getValue();
                                if (!imageUrls || imageUrls.length === 0) return "";
                                const container = document.createElement('div');
                                container.className = 'preview-container';
                                
                                imageUrls.forEach((url, index) => {
                                    const previewBox = document.createElement('div');
                                    previewBox.className = 'preview-box';
                                    const thumbUrl = `https://wsrv.nl/?url=${encodeURIComponent(url)}&w=60&h=60&output=webp&q=80`;
                                    previewBox.style.backgroundImage = `url('${thumbUrl}')`;
                                    previewBox.style.backgroundSize = "cover";
                                    previewBox.style.backgroundPosition = "center";
                                    previewBox.setAttribute('data-image-index', index);
                                    previewBox.dataset.src = url; 
                                    container.appendChild(previewBox);
                                });

                                const updateScrub = (e) => {
                                    if(e.cancelable) e.preventDefault(); 
                                    const rect = container.getBoundingClientRect();
                                    const touch = e.touches[0];
                                    const touchX = touch.clientX - rect.left;
                                    let percent = touchX / rect.width;
                                    percent = Math.max(0, Math.min(1, percent)); 
                                    const totalImages = imageUrls.length;
                                    const index = Math.floor(percent * totalImages);
                                    const clampedIndex = Math.min(totalImages - 1, index);

                                    centerTooltip(); 
                                    showTooltip(imageUrls, clampedIndex, false, true);
                                    
                                    const boxes = container.querySelectorAll('.preview-box');
                                    boxes.forEach(b => b.style.borderColor = ''); 
                                    if(boxes[clampedIndex]) boxes[clampedIndex].style.borderColor = 'darkorange';
                                    
                                    updateHudHighlight(clampedIndex); 
                                };

                                container.addEventListener('touchstart', (e) => { updateScrub(e); }, {passive: false});
                                container.addEventListener('touchmove', (e) => { updateScrub(e); }, {passive: false});
                                container.addEventListener('touchend', (e) => {
                                    const boxes = container.querySelectorAll('.preview-box');
                                    boxes.forEach(b => b.style.borderColor = ''); 
                                });
                                return container;
                            },
                        },
                        {
                            title:"$ Price", field:"price", hozAlign:"right", sorter:"number",
                            sorterParams:{ alignEmptyValues:"bottom" },
                            formatter:function(cell){
                                const val = cell.getValue();
                                if(val === null) return "N/A"; 
                                const c = getGradientColor(val,colMinMax['price'].min,colMinMax['price'].max,true);
                                cell.getElement().style.backgroundColor = c;
                                cell.getElement().style.color="#fff";
                                return val;
                            }
                        },
                        { title:"$ Ship or Fly", field:"shipOrFly", hozAlign:"right", sorter:"number", sorterParams:{ alignEmptyValues:"bottom" }, formatter: formatTextCell, cssClass: "text-cell" },
                        { title:"$ Tariff (2025)", field:"tariff", hozAlign:"right", sorter:"number", sorterParams:{ alignEmptyValues:"bottom" }, formatter: formatTextCell, cssClass: "text-cell" },
                        { title:"$ Ship", field:"ship", hozAlign:"right", sorter:"number", sorterParams:{ alignEmptyValues:"bottom" }, formatter: formatTextCell, cssClass: "text-cell" },
                        { title:"$ Air Travel", field:"airTravel", hozAlign:"right", sorter:"number", sorterParams:{ alignEmptyValues:"bottom" }, formatter: formatTextCell, cssClass: "text-cell" },
                        { title:"$ Travel Surplus", field:"travelSurplus", hozAlign:"right", sorter:"number", sorterParams:{ alignEmptyValues:"bottom" }, formatter: formatTextCell, cssClass: "text-cell" },
                        { title:"Aesthetic", field:"aesthetic", formatter: formatTextCell, cssClass: "text-cell" },
                        { title:"Status", field:"status", formatter: formatTextCell, cssClass: "text-cell" },
                        {
                            title:"Specialty", 
                            field:"specialty", 
                            width: 300,
                            headerFilter: function(cell, onRendered, success, cancel, editorParams){
                                const container = document.createElement("div");
                                container.id = "specialty-filter-container";
                                container.className = "filter-container";
                                setTimeout(updateFilterHeader, 100); 
                                return container;
                            },
                            headerFilterFunc: function(headerValue, rowValue, rowData, filterParams){
                                if (!headerValue || headerValue.length === 0) return true;
                                if (!rowValue) return false;
                                const rowTags = rowValue.split(',').map(t => t.trim());
                                let match = false;
                                headerValue.forEach(filterTag => {
                                    if (rowTags.includes(filterTag)) match = true;
                                });
                                return match;
                            },
                            formatter: function(cell) {
                                const val = cell.getValue();
                                if (!val) return "";
                                const tags = val.split(',').map(t => t.trim()).filter(t => t);
                                const wrapper = document.createElement('div');
                                wrapper.className = 'tag-wrapper';
                                tags.forEach(tag => {
                                    const span = document.createElement('span');
                                    span.className = 'specialty-tag';
                                    span.textContent = tag;
                                    span.onclick = function(e) {
                                        e.stopPropagation(); 
                                        window.addSpecialtyFilter(tag);
                                    };
                                    wrapper.appendChild(span);
                                });
                                return wrapper;
                            }
                        },
                        {
                            title:"Partials", field:"partials", hozAlign:"right", sorter:"number",
                            sorterParams:{ alignEmptyValues:"bottom" },
                            formatter:function(cell){
                                const val = cell.getValue();
                                if(val === null) return "";
                                const c = getGradientColor(val,colMinMax['partials'].min,colMinMax['partials'].max,false);
                                cell.getElement().style.backgroundColor = c;
                                cell.getElement().style.color="#fff";
                                return val;
                            }
                        },
                        {
                            title:"Fursuits", field:"fursuits", hozAlign:"right", sorter:"number",
                            sorterParams:{ alignEmptyValues:"bottom" },
                            formatter:function(cell){
                                const val = cell.getValue();
                                if(val === null) return "";
                                const c = getGradientColor(val,colMinMax['fursuits'].min,colMinMax['fursuits'].max,false);
                                cell.getElement().style.backgroundColor = c;
                                cell.getElement().style.color="#fff";
                                return val;
                            }
                        },
                        {
                            title:"Portfolio Size", field:"portfolio", hozAlign:"right", sorter:"number",
                            sorterParams:{ alignEmptyValues:"bottom" },
                            formatter:function(cell){
                                const val = cell.getValue();
                                if(val === null) return "";
                                const c = getGradientColor(val,colMinMax['portfolio'].min,colMinMax['portfolio'].max,false);
                                cell.getElement().style.backgroundColor = c;
                                cell.getElement().style.color="#fff";
                                return val;
                            }
                        },
                        { title:"Country", field:"country", formatter: formatTextCell, cssClass: "text-cell" },
                        {
                            title:"Followers", field:"followers", hozAlign:"right", sorter:"number",
                            sorterParams:{ alignEmptyValues:"bottom" },
                            formatter:function(cell){
                                const val = cell.getValue();
                                if(val === null) return "";
                                const displayVal = val.toLocaleString(); 
                                const c = getGradientColor(val,colMinMax['followers'].min,colMinMax['followers'].max,false);
                                cell.getElement().style.backgroundColor = c;
                                cell.getElement().style.color="#fff";
                                return displayVal;
                            }
                        },
                        {
                            title:"Acct Age", field:"acctAge", hozAlign:"right", sorter:"number",
                            sorterParams:{ alignEmptyValues:"bottom" }, 
                            formatter:function(cell){
                                const val = cell.getValue();
                                if(val === null) return "";
                                const c = getGradientColor(val,colMinMax['acctAge'].min,colMinMax['acctAge'].max,false);
                                cell.getElement().style.backgroundColor = c;
                                cell.getElement().style.color="#fff";
                                return val;
                            }
                        },
                        { title:"Acct Date", field:"acctDate", formatter: formatTextCell, cssClass: "text-cell" }
                    ],
                    rowFormatter:function(row){
                        const el = row.getElement();
                        if(row.getIndex()%2===0) el.style.backgroundColor="#383838";
                        else el.style.backgroundColor="#2e2e2e";
                    },
                    reactiveData:true, virtualDom:true
                });

                
                document.getElementById("sort-field").addEventListener("change", function(){
                     const field = this.value; const dir = document.getElementById("sort-dir").value; table.setSort(field, dir);
                });
                document.getElementById("sort-dir").addEventListener("change", function(){
                     const field = document.getElementById("sort-field").value; const dir = this.value; table.setSort(field, dir);
                });
            }
        });

        // --- GLOBAL HOVER TRACKING ---
        let lastTiltCell = null; 
        document.addEventListener('mousemove', (e) => {
            const target = e.target;
            const isOverPreview = target.closest('.preview-box');
            const isOverLogo = target.closest('.logo-box'); 
            const isOverTooltip = target.closest('#image-tooltip');
            
            // PART 1: REACTIVE TILT
            const cell = target.closest('.tabulator-cell');
            if (lastTiltCell && lastTiltCell !== cell) {
                const oldWrapper = lastTiltCell.querySelector('.text-wrapper');
                if (oldWrapper) oldWrapper.style.transform = '';
                lastTiltCell.style.transform = 'none';
                lastTiltCell.classList.remove('active-tilt');
                lastTiltCell = null;
            }
            if (cell) {
                lastTiltCell = cell;
                cell.classList.add('active-tilt');
                const rect = cell.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const mouseX = e.clientX - centerX;
                const mouseY = e.clientY - centerY;
                const rotateX = -1 * (mouseY / (rect.height / 2)) * 10; 
                const rotateY = (mouseX / (rect.width / 2)) * 10;
                const wrapper = cell.querySelector('.text-wrapper');
                const transformString = `perspective(500px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.15)`;
                
                if (wrapper) { wrapper.style.transform = `translateY(-50%) ${transformString}`; } 
                else if (!cell.querySelector('a') && !cell.querySelector('.tag-wrapper')) { 
                     cell.style.transform = `perspective(500px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
                }
            }

            // PART 2: TOOLTIP
            const sourceBox = isOverPreview || isOverLogo;
            if (sourceBox) {
                clearTimeout(hideTimeout);
                const rowEl = target.closest('.tabulator-row');
                if (rowEl && table) {
                    const row = table.getRow(rowEl);
                    if (row) {
                        const rowData = row.getData();
                        let imageUrls = []; let index = 0; let isLogo = false;
                        
                        if (isOverPreview) {
                            imageUrls = rowData.previewImages;
                            index = parseInt(sourceBox.getAttribute('data-image-index'), 10);
                            isLogo = false;
                        } else if (isOverLogo) {
                            imageUrls = [rowData.logo]; index = 0; isLogo = true;
                        }
                        
                        if (imageUrls && imageUrls.length > 0) {
                            const isNewContent = (currentPreviewImages[0] !== imageUrls[0] || currentPreviewImages.length !== imageUrls.length);
                            if (tooltipEl.style.display === 'none' || isNewContent || currentImageIndex !== index || isLogo) {
                                const shouldAnimate = (isNewContent || currentImageIndex !== index);
                                if (isLogo) {
                                    clearInterval(slideshowInterval); 
                                    moveTooltip(e); 
                                    // LOGO: Enable HUD = FALSE
                                    if (tooltipEl.style.display === 'none' || isNewContent) { showTooltip(imageUrls, index, true, false); }
                                } else {
                                    clearInterval(slideshowInterval); 
                                    centerTooltip(); 
                                    // PREVIEW: Enable HUD = TRUE
                                    if (isNewContent || currentImageIndex !== index) { 
                                        showTooltip(imageUrls, index, shouldAnimate, true); 
                                        updateHudHighlight(index); 
                                    } 
                                    else { 
                                        tooltipEl.style.display = "flex"; 
                                    }
                                }
                            }
                        }
                    }
                }
            } else if (!isOverTooltip && tooltipEl.style.display !== 'none') { hideTooltip(); }
        });
    </script>

</body>
</html>